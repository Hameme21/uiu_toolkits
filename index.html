<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UIU ToolKits | Spring 2026</title>
    <style>
        /* --- GLOBAL VARIABLES & THEME --- */
        :root {
            --uiu-orange: #F37021;
            --uiu-blue: #005696;
            
            /* Light Theme */
            --bg-body: #fdf8f5;
            --bg-container: #ffffff;
            --bg-input: #ffffff;
            --text-main: #333333;
            --text-muted: #666666;
            --border-color: #ffdcb0;
            
            /* Primary Accents */
            --primary-color: #F37021; 
            --secondary-color: #005696;
            --table-header-bg: #F37021;
            --table-header-text: #ffffff;
            
            /* Alert Colors */
            --clash-bg: #ffebee;
            --clash-border: #d32f2f;
            --same-day-bg: #fff8e1;
            --same-day-border: #ffc107;
            --course-added-bg: #fff3e0;
            
            --shadow: 0 4px 15px rgba(243, 112, 33, 0.15);
            --warning-bg: #fff3cd;
            --warning-text: #856404;
            --warning-border: #ffeeba;
        }

        /* Dark Mode Override */
        body.dark-mode {
            --bg-body: #121212;
            --bg-container: #1e1e1e;
            --bg-input: #2d2d2d;
            --text-main: #e0e0e0;
            --text-muted: #a0a0a0;
            --border-color: #333333;
            
            --primary-color: #F37021;
            --secondary-color: #64b5f6;
            --table-header-bg: #d85a0e;
            
            --clash-bg: #3e1a1a;
            --same-day-bg: #3e3310;
            --same-day-border: #9c7b16;
            --course-added-bg: #2d2318;
            
            --shadow: 0 4px 15px rgba(0,0,0,0.5);
            --warning-bg: #332701;
            --warning-text: #ffc107;
            --warning-border: #664d03;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            transition: background 0.3s, color 0.3s;
        }

        /* --- NAVIGATION --- */
        nav {
            background-color: var(--bg-container);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 3px solid var(--primary-color);
        }

        .logo {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 8px 16px;
            border: 2px solid var(--primary-color);
            background: transparent;
            color: var(--primary-color);
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .nav-btn.active, .nav-btn:hover {
            background: var(--primary-color);
            color: white;
        }
        
        body.dark-mode .nav-btn {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        body.dark-mode .nav-btn.active, 
        body.dark-mode .nav-btn:hover {
            background: var(--primary-color);
            color: #121212;
        }

        /* --- LAYOUT --- */
        .container {
            max-width: 1100px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .tool-section {
            display: none;
            background: var(--bg-container);
            padding: 25px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.3s;
            border-top: 5px solid var(--primary-color);
        }
        .tool-section.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 { color: var(--primary-color); margin-top: 0; text-align: center; }
        p.subtitle { color: var(--text-muted); text-align: center; margin-bottom: 20px; }

        /* --- ALERTS --- */
        .disclaimer-box {
            background-color: var(--warning-bg);
            color: var(--warning-text);
            border: 1px solid var(--warning-border);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
            font-size: 0.9em;
        }

        .alert-box {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 10px;
            text-align: center;
            font-weight: bold;
            display: none;
        }
        #clash-alert { background-color: var(--clash-bg); color: #d32f2f; border: 1px solid var(--clash-border); }
        #sameday-alert { background-color: var(--same-day-bg); color: #c49000; border: 1px solid var(--same-day-border); }
        body.dark-mode #sameday-alert { color: #ffca28; }

        /* --- INPUTS & SEARCH --- */
        .search-box { position: relative; max-width: 600px; margin: 0 auto 20px auto; }
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            background: var(--bg-input);
            color: var(--text-main);
            border-radius: 6px;
            font-size: 1rem;
            box-sizing: border-box;
        }
        input:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 2px rgba(243, 112, 33, 0.2); }

        .suggestions {
            position: absolute; top: 100%; left: 0; right: 0;
            background: var(--bg-container);
            border: 1px solid var(--border-color);
            max-height: 250px; overflow-y: auto; z-index: 100;
            display: none;
            border-radius: 0 0 6px 6px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .suggestion-item {
            padding: 10px 15px; cursor: pointer; border-bottom: 1px solid var(--border-color);
            display: flex; justify-content: space-between; align-items: center;
        }
        .suggestion-item:hover { background-color: var(--bg-body); }
        .suggestion-item strong { color: var(--primary-color); }
        .shortcut-badge { background: var(--border-color); font-size: 0.75em; padding: 2px 6px; border-radius: 4px; color: var(--text-muted); }

        /* --- EXAM TABLE --- */
        .routine-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .routine-table th, .routine-table td {
            border: 1px solid var(--border-color);
            padding: 10px; text-align: center; vertical-align: top;
        }
        .routine-table th { background-color: var(--table-header-bg); color: var(--table-header-text); }
        
        .added-course {
            background-color: var(--course-added-bg);
            border-left: 4px solid var(--primary-color);
            padding: 8px 25px 8px 8px;
            margin-top: 5px;
            border-radius: 4px;
            font-size: 0.9em;
            text-align: left;
            position: relative;
        }
        .added-course.clash { background-color: var(--clash-bg); border-left-color: var(--clash-border); color: #d32f2f; }
        .added-course.sameday { border-left-color: var(--same-day-border); background-color: var(--same-day-bg); }
        
        .remove-btn {
            position: absolute; top: 2px; right: 5px;
            cursor: pointer; color: var(--text-muted); font-size: 1.2em; font-weight: bold;
        }
        .remove-btn:hover { color: red; }

        /* --- CGPA STYLES --- */
        .section-box { border: 1px solid var(--border-color); padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .section-title {
            color: var(--primary-color); font-weight: bold; display: block;
            border-left: 4px solid var(--primary-color); padding-left: 10px; margin-bottom: 15px;
        }
        .cgpa-table { width: 100%; margin-bottom: 15px; border-collapse: collapse; }
        .cgpa-table th { background-color: var(--primary-color); color: white; padding: 10px; text-align: left; }
        .cgpa-table td { padding: 10px; border-bottom: 1px solid var(--border-color); vertical-align: middle; }

        .btn-action { width: 100%; padding: 12px; border-radius: 6px; border: none; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-add { background-color: var(--secondary-color); color: white; width: auto; padding: 8px 20px; }
        .btn-calc { background-color: var(--primary-color); color: white; font-size: 1.1em; }
        .btn-delete { background-color: #ff4d4d; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 0.8em; }

        .result-box {
            background-color: var(--course-added-bg); border: 2px solid var(--primary-color);
            padding: 20px; border-radius: 8px; text-align: center; display: none; margin-top: 20px;
        }
        .gpa-value { font-size: 2rem; font-weight: bold; color: var(--primary-color); }
        
        .retake-controls { display: flex; align-items: center; gap: 8px; }
        .prev-grade-wrapper { display: none; margin-top: 5px; }
        .prev-grade-wrapper.active { display: block; animation: fadeIn 0.3s; }
        .prev-grade-label { font-size: 0.8em; color: var(--text-muted); display: block; margin-bottom: 2px; }
        .retake-checkbox { width: 18px; height: 18px; cursor: pointer; }

        /* --- FULL CALENDAR STYLES --- */
        .calendar-controls {
            display: flex; justify-content: space-between; align-items: center; 
            margin-bottom: 15px; background: var(--bg-input); padding: 10px 20px;
            border-radius: 8px; border: 1px solid var(--border-color);
        }
        .calendar-controls button {
            background: var(--primary-color); color: white; border: none; 
            padding: 8px 15px; border-radius: 6px; cursor: pointer; font-weight: bold;
        }
        .calendar-controls button:hover { background: var(--secondary-color); }
        .calendar-controls h2 { margin: 0; color: var(--secondary-color); }

        .calendar-wrapper { border-radius: 8px; overflow: hidden; border: 1px solid var(--border-color); }
        .calendar-grid-header {
            display: grid; grid-template-columns: repeat(7, 1fr); 
            background: var(--table-header-bg); color: var(--table-header-text); 
            text-align: center; font-weight: bold; padding: 12px 0;
        }
        .calendar-grid {
            display: grid; grid-template-columns: repeat(7, 1fr); 
            background: var(--border-color); gap: 1px; /* Creates borders between cells */
        }
        .calendar-day {
            background: var(--bg-container); min-height: 100px; 
            padding: 8px; display: flex; flex-direction: column; gap: 4px;
        }
        .calendar-day.empty { background: var(--bg-body); }
        .day-num { font-weight: bold; font-size: 1.1em; color: var(--text-muted); text-align: right; display: block; margin-bottom: 5px; }
        
        .event-badge {
            font-size: 0.75em; padding: 5px 8px; border-radius: 4px; 
            background-color: var(--course-added-bg); border-left: 3px solid var(--primary-color);
            color: var(--text-main); font-weight: bold; line-height: 1.2;
        }
        .event-holiday { background-color: var(--clash-bg); border-left-color: var(--clash-border); color: #d32f2f; }
        .event-exam { background-color: var(--same-day-bg); border-left-color: var(--same-day-border); color: #b08100; }
        body.dark-mode .event-exam { color: #ffca28; }

        @media (max-width: 600px) {
            nav { flex-direction: column; gap: 10px; }
            .routine-table th, .routine-table td { font-size: 0.8em; padding: 5px; }
            .calendar-grid-header { font-size: 0.8em; }
            .calendar-day { min-height: 80px; padding: 4px; }
            .event-badge { font-size: 0.65em; padding: 3px; }
        }
    </style>
</head>
<body>

<nav>
    <div class="logo">üéì UIU Toolkit</div>
    <div class="nav-buttons">
        <button class="nav-btn active" onclick="switchTab('exam')" id="btn-exam">Exam Routine</button>
        <button class="nav-btn" onclick="switchTab('cgpa')" id="btn-cgpa">CGPA Calc</button>
        <button class="nav-btn" onclick="switchTab('calendar')" id="btn-calendar">Academic Calendar</button>
        <button class="nav-btn" onclick="toggleTheme()" id="btn-theme">üåô</button>
    </div>
</nav>

<div class="container">

    <div id="exam-section" class="tool-section active">
        <h1>Exam Clash Solver</h1>
        <p class="subtitle">Spring 2026 | CSE Dept. | Updated with Official Routine</p>

        <div class="disclaimer-box">
            ‚ö†Ô∏è DISCLAIMER: Data sourced from the "Spring 2026 Exam Template". Always verify with your official UCAM routine for last-minute changes.
        </div>

        <div id="clash-alert" class="alert-box">‚ö†Ô∏è CRITICAL CLASH: You have 2 exams at the EXACT same time!</div>
        <div id="sameday-alert" class="alert-box">‚ö†Ô∏è PRESSURE WARNING: Multiple exams on the same day.</div>

        <div class="search-box">
            <input type="text" id="courseSearch" placeholder="Type Code (e.g. 3811), Name (Artificial Intelligence), or Shortcut (AI)..." oninput="filterCourses()">
            <div class="suggestions" id="suggestions"></div>
        </div>

        <table class="routine-table">
            <thead>
                <tr>
                    <th style="width:10%">Day</th>
                    <th style="width:30%">Slot T1<br><small>9:00 - 11:00 AM</small></th>
                    <th style="width:30%">Slot T2<br><small>11:30 - 1:30 PM</small></th>
                    <th style="width:30%">Slot T3<br><small>2:00 - 4:00 PM</small></th>
                </tr>
            </thead>
            <tbody id="routineBody"></tbody>
        </table>
    </div>

    <div id="cgpa-section" class="tool-section">
        <h1>CGPA Calculator</h1>
        <p class="subtitle">UIU Grading Scale with Retake Support</p>

        <div class="section-box">
            <span class="section-title">Previous Results (Optional)</span>
            <div style="display: flex; gap: 10px;">
                <div style="flex:1"><label>Prev. CGPA</label><input type="number" id="prevCGPA" placeholder="e.g. 3.50" step="0.01"></div>
                <div style="flex:1"><label>Credits Earned</label><input type="number" id="prevCredits" placeholder="e.g. 60" step="1"></div>
            </div>
        </div>

        <div class="section-box">
            <span class="section-title">Current Trimester</span>
            <table class="cgpa-table" id="courseTable">
                <thead>
                    <tr>
                        <th style="width: 5%">#</th>
                        <th style="width: 20%">Credits</th>
                        <th style="width: 25%">Expected Grade</th>
                        <th style="width: 40%">Type</th>
                        <th style="width: 10%">X</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <button class="btn-action btn-add" onclick="addCourseRow()">+ Add Course</button>
        </div>

        <button class="btn-action btn-calc" onclick="calculateCGPA()">Calculate CGPA</button>

        <div id="resultBox" class="result-box">
            <div>Current GPA: <span class="gpa-value" id="currentGPA">0.00</span></div>
            <div>Total CGPA: <span class="gpa-value" id="totalCGPA">0.00</span></div>
            <p>Total Credits: <span id="totalCreditsDisplay">0</span></p>
        </div>
    </div>

    <div id="calendar-section" class="tool-section">
        <h1>Spring 2026 Academic Calendar</h1>
        <p class="subtitle">Interactive Event Planner</p>

        <div class="search-box">
            <input type="text" id="calendarSearch" placeholder="Search events or dates (e.g., 'Mid-Term', 'Eid', 'Mar 15')..." oninput="searchCalendarEvents()">
            <div class="suggestions" id="calendarSuggestions"></div>
        </div>

        <div class="calendar-controls">
            <button onclick="changeMonth(-1)">&#10094; Prev</button>
            <h2 id="month-year-display">February 2026</h2>
            <button onclick="changeMonth(1)">Next &#10095;</button>
        </div>

        <div class="calendar-wrapper">
            <div class="calendar-grid-header">
                <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
            </div>
            <div id="calendar-days" class="calendar-grid">
                </div>
        </div>
    </div>

</div>

<script>
    // --- DATA: SPRING 2026 ROUTINE MAPPING ---
    const rawRoutine = [
        { day: 1, time: 1, codes: ["ENG 1011", "ENG 101"], name: "Intensive English I", keywords: ["eng 1", "english"] },
        { day: 1, time: 1, codes: ["CSE 4509", "CSI 309"], name: "Operating Systems Concepts", keywords: ["os", "operating"] },
        { day: 1, time: 1, codes: ["IPE 3401", "IPE 401"], name: "Industrial & Operational Management", keywords: ["ipe", "management"] },
        { day: 1, time: 1, codes: ["DS 4491"], name: "Data Science Elective", keywords: [] },
        { day: 1, time: 2, codes: ["ENG 1013", "ENG 103"], name: "Intensive English II", keywords: ["eng 2", "english"] },
        { day: 1, time: 2, codes: ["DS 3885"], name: "DS Elective", keywords: [] },
        { day: 1, time: 2, codes: ["CSE 4945"], name: "UI: Concepts and Design", keywords: ["ui", "design", "user interface"] },
        { day: 1, time: 3, codes: ["MATH 2183", "MATH 183"], name: "Calculus & Linear Algebra", keywords: ["linear", "math", "calculus"] },
        { day: 1, time: 3, codes: ["CSE 3313", "CSE 313"], name: "Computer Architecture", keywords: ["ca", "archi"] },
        { day: 1, time: 3, codes: ["SOC 2101", "SOC 101"], name: "Society, Env. & Engineering Ethics", keywords: ["soc", "ethics"] },
        { day: 1, time: 3, codes: ["CSE 4889", "CSE 489"], name: "Machine Learning", keywords: ["ml", "machine"] },
        { day: 2, time: 1, codes: ["CSE 4621", "CSI 421"], name: "Computer Graphics", keywords: ["cg", "graphics"] },
        { day: 2, time: 1, codes: ["CSE 3521", "CSI 221"], name: "Database Management Systems", keywords: ["dbms", "database"] },
        { day: 2, time: 2, codes: ["CSE 4325", "CSE 425"], name: "Microprocessors & Microcontrollers", keywords: ["micro", "mpi"] },
        { day: 2, time: 2, codes: ["MATH 1151", "MATH 151"], name: "Fundamental Calculus", keywords: ["calc 1", "calculus"] },
        { day: 2, time: 3, codes: ["ACT 2111", "ACT 111"], name: "Financial & Managerial Accounting", keywords: ["act", "accounting"] },
        { day: 2, time: 3, codes: ["MATH 2205", "STAT 205"], name: "Probability & Statistics", keywords: ["stat", "prob"] },
        { day: 3, time: 1, codes: ["CSE 3811", "CSI 341"], name: "Artificial Intelligence", keywords: ["ai", "artificial"] },
        { day: 3, time: 1, codes: ["CSE 4451"], name: "Human Computer Interaction", keywords: ["hci"] },
        { day: 3, time: 2, codes: ["CSE 2213", "CSI 219"], name: "Discrete Mathematics", keywords: ["dm", "discrete"] },
        { day: 3, time: 2, codes: ["PMG 4101", "CSE 469"], name: "Project Management", keywords: ["pmg", "project"] },
        { day: 3, time: 2, codes: ["TEC 2499"], name: "Technology Entrepreneurship", keywords: ["entrepreneurship"] },
        { day: 3, time: 3, codes: ["CSE 1325", "CSE 225"], name: "Digital Logic Design", keywords: ["dld", "logic"] },
        { day: 3, time: 3, codes: ["CSE 4587", "CSE 487"], name: "Cloud Computing", keywords: ["cloud"] },
        { day: 3, time: 3, codes: ["BIO 3105", "BIO 101"], name: "Biology for Engineers", keywords: ["bio", "biology"] },
        { day: 3, time: 3, codes: ["CSE 4777"], name: "Network Security", keywords: ["security", "netsec"] },
        { day: 4, time: 1, codes: ["CSE 4611", "CSI 411"], name: "Compiler Design", keywords: ["compiler", "cd"] },
        { day: 4, time: 1, codes: ["CSE 4883", "CSI 483"], name: "Digital Image Processing", keywords: ["dip", "image"] },
        { day: 4, time: 2, codes: ["CSE 1111", "CSI 121"], name: "Structured Programming Language", keywords: ["spl", "c programming"] },
        { day: 4, time: 2, codes: ["CSE 2215", "CSI 217"], name: "Data Structure & Algorithms I", keywords: ["dsa 1", "dsa"] },
        { day: 4, time: 2, codes: ["DS 1501"], name: "Programming for Data Science", keywords: ["pds"] },
        { day: 4, time: 2, codes: ["CSE 4435"], name: "Software Architecture", keywords: ["sa", "architecture"] },
        { day: 4, time: 2, codes: ["DS 2251"], name: "Data Structures & Algorithms II (DS)", keywords: [] },
        { day: 4, time: 3, codes: ["CSE 3711", "CSE 323"], name: "Computer Networks", keywords: ["network", "net", "cn"] },
        { day: 4, time: 3, codes: ["DS 4523"], name: "DS Elective", keywords: [] },
        { day: 4, time: 3, codes: ["CSE 4893", "CSE 493"], name: "Introduction to Bioinformatics", keywords: ["bioinformatics"] },
        { day: 4, time: 3, codes: ["DS 3101"], name: "Data Science Core", keywords: [] },
        { day: 5, time: 1, codes: ["MATH 2201", "MATH 201"], name: "Coord. Geometry & Vector Analysis", keywords: ["math 2", "vector"] },
        { day: 5, time: 1, codes: ["CSE 3411", "CSI 311"], name: "System Analysis and Design", keywords: ["sad", "system analysis"] },
        { day: 5, time: 1, codes: ["EEE 4261"], name: "Green Computing", keywords: ["green", "energy"] },
        { day: 5, time: 2, codes: ["CSE 2217", "CSI 227"], name: "Data Structure & Algorithms II", keywords: ["dsa 2", "algo"] },
        { day: 5, time: 2, codes: ["DS 1101"], name: "Fund. of Data Science", keywords: ["fds"] },
        { day: 5, time: 3, codes: ["CSE 3421", "CSI 321"], name: "Software Engineering", keywords: ["se", "software"] },
        { day: 6, time: 1, codes: ["BDS 1201"], name: "History of the Emergence of BD", keywords: ["bds", "history"] },
        { day: 6, time: 1, codes: ["ECO 4101", "ECO 213"], name: "Economics", keywords: ["eco", "economics"] },
        { day: 6, time: 1, codes: ["DS 3521"], name: "Database Systems (DS)", keywords: [] },
        { day: 6, time: 2, codes: ["CSE 1115", "CSI 211"], name: "Object Oriented Programming", keywords: ["oop", "java"] },
        { day: 6, time: 2, codes: ["CSE 4783"], name: "Cryptography", keywords: ["crypto", "security"] },
        { day: 6, time: 2, codes: ["DS 4891"], name: "DS Elective", keywords: [] },
        { day: 6, time: 3, codes: ["EEE 2113", "CSE 113"], name: "Electrical Circuits", keywords: ["circuit", "electrical"] },
        { day: 6, time: 3, codes: ["EEE 2123", "CSE 123"], name: "Electronics", keywords: ["electronics"] },
        { day: 6, time: 3, codes: ["CSE 4531"], name: "Computer Security", keywords: ["security", "cyber"] },
        { day: 6, time: 3, codes: ["CSE 4181", "CSE 481"], name: "Mobile App Development", keywords: ["mad", "android"] },
        { day: 7, time: 1, codes: ["CSE 4891", "CSE 491"], name: "Data Mining", keywords: ["mining", "dm"] },
        { day: 7, time: 1, codes: ["CSE 4165", "CSE 465"], name: "Web Programming", keywords: ["web", "internet"] },
        { day: 7, time: 2, codes: ["CSE 2233", "CSI 233"], name: "Theory of Computation", keywords: ["toc", "theory"] },
        { day: 7, time: 3, codes: ["CSE 4495", "CSE 495"], name: "Software Testing & QA", keywords: ["sqa", "testing"] },
        { day: 7, time: 3, codes: ["PHY 2105", "PHY 105"], name: "Physics", keywords: ["phy", "physics"] },
        { day: 7, time: 3, codes: ["DS 3881"], name: "DS Elective", keywords: [] }
    ];

    // --- ACADEMIC CALENDAR EVENTS DATA ---
    // Updated directly from UIU Spring 2026 Academic Calendar PDF
    const academicEvents = [
        { start: "2026-02-23", end: "2026-02-23", title: "Registration without Fine", type: "regular" },
        { start: "2026-03-02", end: "2026-03-02", title: "Drop course (100% refund)", type: "regular" },
        { start: "2026-03-09", end: "2026-03-09", title: "Apply Grade Change (Fall '25)", type: "regular" },
        { start: "2026-03-10", end: "2026-03-10", title: "Drop course (50% refund)", type: "regular" },
        { start: "2026-03-13", end: "2026-03-13", title: "Grade Submission for incomplete Grades", type: "regular" },
        { start: "2026-03-15", end: "2026-03-15", title: "Registration (500Tk Fine)", type: "regular" },
        { start: "2026-03-27", end: "2026-03-27", title: "Holiday: Shab-e-Qadr/Eid/Independence Day", type: "holiday" },
        { start: "2026-04-13", end: "2026-04-13", title: "Make-up class (Tue Classes)", type: "regular" },
        { start: "2026-04-14", end: "2026-04-14", title: "Holiday: Bangla New Year", type: "holiday" },
        { start: "2026-04-18", end: "2026-04-24", title: "Mid-Term Exams", type: "exam" },
        { start: "2026-04-25", end: "2026-04-25", title: "Make-up class (Tue/Wed Classes)", type: "regular" },
        { start: "2026-05-12", end: "2026-05-12", title: "2nd Installment Deadline", type: "regular" },
        { start: "2026-05-20", end: "2026-05-20", title: "Holiday: Eid-ul-Adha", type: "holiday" },
        { start: "2026-06-14", end: "2026-06-14", title: "3rd Installment Deadline", type: "regular" },
        { start: "2026-06-20", end: "2026-06-20", title: "Exam Prep (No Classes)", type: "regular" },
        { start: "2026-06-21", end: "2026-06-30", title: "Final Exams", type: "exam" }, 
        { start: "2026-07-07", end: "2026-07-07", title: "Summer 2026 Begins", type: "regular" }
    ];

    let myCourses = [];

    // --- TAB SWITCHER ---
    function switchTab(tab) {
        document.querySelectorAll('.tool-section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(tab + '-section').classList.add('active');
        document.getElementById('btn-' + tab).classList.add('active');
        if (tab === 'calendar') renderFullCalendar();
    }

    // --- THEME TOGGLE ---
    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
        const btn = document.getElementById('btn-theme');
        if (document.body.classList.contains('dark-mode')) {
            btn.innerHTML = '‚òÄÔ∏è';
            localStorage.setItem('theme', 'dark');
        } else {
            btn.innerHTML = 'üåô';
            localStorage.setItem('theme', 'light');
        }
    }
    if (localStorage.getItem('theme') === 'dark') toggleTheme();

    // --- EXAM LOGIC ---
    function initGrid() {
        const tbody = document.getElementById('routineBody');
        tbody.innerHTML = '';
        for (let i = 1; i <= 7; i++) {
            tbody.innerHTML += `<tr><td class="day-header">Day ${i}</td><td id="d${i}-t1"></td><td id="d${i}-t2"></td><td id="d${i}-t3"></td></tr>`;
        }
    }

    function filterCourses() {
        const input = document.getElementById('courseSearch').value.toLowerCase();
        const suggestionBox = document.getElementById('suggestions');
        suggestionBox.innerHTML = '';
        if (input.length < 2) { suggestionBox.style.display = 'none'; return; }

        const matches = [];
        rawRoutine.forEach(item => {
            if (item.name.toLowerCase().includes(input) || item.codes.some(c => c.toLowerCase().includes(input)) || item.keywords.some(k => k.toLowerCase().includes(input))) {
                matches.push({ displayName: `${item.name} (${item.codes[0]})`, data: item });
            }
        });

        if (matches.length > 0) {
            suggestionBox.style.display = 'block';
            matches.forEach(match => {
                const div = document.createElement('div');
                div.className = 'suggestion-item';
                div.innerHTML = `<strong>${match.displayName}</strong>`;
                div.onclick = () => addCourse(match.data);
                suggestionBox.appendChild(div);
            });
        } else { suggestionBox.style.display = 'none'; }
    }

    function addCourse(courseData) {
        if (myCourses.some(c => c.name === courseData.name && c.codes[0] === courseData.codes[0])) { alert("Course already added!"); return; }
        myCourses.push(courseData);
        document.getElementById('courseSearch').value = '';
        document.getElementById('suggestions').style.display = 'none';
        renderSchedule();
    }

    function renderSchedule() {
        for (let d = 1; d <= 7; d++) {
            for (let t = 1; t <= 3; t++) { document.getElementById(`d${d}-t${t}`).innerHTML = ''; }
        }
        let timeClash = false, sameDayPressure = false;
        const dayCounts = {}, slotMap = {};
        
        myCourses.forEach(course => {
            const key = `d${course.day}-t${course.time}`;
            if (!slotMap[key]) slotMap[key] = [];
            slotMap[key].push(course);
            if (!dayCounts[course.day]) dayCounts[course.day] = 0;
            dayCounts[course.day]++;
        });

        for (const [key, coursesInSlot] of Object.entries(slotMap)) {
            const cell = document.getElementById(key);
            const isClash = coursesInSlot.length > 1;
            if (isClash) timeClash = true;

            coursesInSlot.forEach(course => {
                const div = document.createElement('div');
                const isSameDay = dayCounts[course.day] > 1;
                let className = 'added-course';
                if (isClash) className += ' clash'; else if (isSameDay) { className += ' sameday'; sameDayPressure = true; }
                div.className = className;
                div.innerHTML = `<span class="remove-btn" onclick="removeCourse('${course.codes[0]}')">&times;</span>
                                 <strong>${course.name}</strong><br><small>${course.codes.join('/')}</small>`;
                cell.appendChild(div);
            });
        }
        document.getElementById('clash-alert').style.display = timeClash ? 'block' : 'none';
        document.getElementById('sameday-alert').style.display = (sameDayPressure && !timeClash) ? 'block' : 'none';
    }

    function removeCourse(code) { myCourses = myCourses.filter(c => c.codes[0] !== code); renderSchedule(); }

    // --- CGPA LOGIC ---
    const gradePoints = { "A":4.00, "A-":3.67, "B+":3.33, "B":3.00, "B-":2.67, "C+":2.33, "C":2.00, "C-":1.67, "D+":1.33, "D":1.00, "F":0.00 };
    
    function addCourseRow() {
        const tbody = document.querySelector("#courseTable tbody");
        const row = document.createElement("tr");
        let opts = ""; for (let g in gradePoints) opts += `<option value="${gradePoints[g]}">${g}</option>`;
        row.innerHTML = `
            <td>${tbody.rows.length + 1}</td>
            <td><input type="number" class="c-credit" value="3" step="0.5"></td>
            <td><select class="c-grade-new">${opts}</select></td>
            <td>
                <div class="retake-controls"><input type="checkbox" class="retake-checkbox" onchange="toggleRetake(this)"><span>Retake?</span></div>
                <div class="prev-grade-wrapper"><span class="prev-grade-label">Old Grade:</span><select class="c-grade-old">${opts}</select></div>
            </td>
            <td><button class="btn-delete" onclick="this.closest('tr').remove(); updateRows()">‚úï</button></td>`;
        tbody.appendChild(row);
    }

    function toggleRetake(checkbox) { checkbox.checked ? checkbox.closest('td').querySelector('.prev-grade-wrapper').classList.add('active') : checkbox.closest('td').querySelector('.prev-grade-wrapper').classList.remove('active'); }
    function updateRows() { document.querySelectorAll("#courseTable tbody tr").forEach((row, i) => row.cells[0].innerText = i + 1); }

    function calculateCGPA() {
        let prevCGPA = parseFloat(document.getElementById("prevCGPA").value) || 0, prevCredits = parseFloat(document.getElementById("prevCredits").value) || 0;
        let totalPoints = prevCGPA * prevCredits, totalCredits = prevCredits, currentPoints = 0, currentCredits = 0;

        document.querySelectorAll("#courseTable tbody tr").forEach(row => {
            const crd = parseFloat(row.querySelector(".c-credit").value) || 0, newGrade = parseFloat(row.querySelector(".c-grade-new").value);
            if (crd > 0) {
                if (row.querySelector(".retake-checkbox").checked) {
                    const oldGrade = parseFloat(row.querySelector(".c-grade-old").value);
                    totalPoints = totalPoints - (oldGrade * crd) + (newGrade * crd);
                    if (oldGrade === 0.00) totalCredits += crd;
                } else { totalPoints += (crd * newGrade); totalCredits += crd; }
                currentPoints += (crd * newGrade); currentCredits += crd; 
            }
        });

        document.getElementById("currentGPA").innerText = currentCredits ? (currentPoints / currentCredits).toFixed(2) : "0.00";
        document.getElementById("totalCGPA").innerText = totalCredits ? (totalPoints / totalCredits).toFixed(2) : "0.00";
        document.getElementById("totalCreditsDisplay").innerText = totalCredits;
        document.getElementById("resultBox").style.display = "block";
    }

    // --- FULL CALENDAR LOGIC ---
    let currentCalYear = 2026;
    let currentCalMonth = 1; // 0-indexed (0=Jan, 1=Feb, 2=Mar...)

    function renderFullCalendar() {
        const daysContainer = document.getElementById('calendar-days');
        const monthYearDisplay = document.getElementById('month-year-display');
        daysContainer.innerHTML = '';
        
        const firstDay = new Date(currentCalYear, currentCalMonth, 1).getDay();
        const daysInMonth = new Date(currentCalYear, currentCalMonth + 1, 0).getDate();
        
        const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        monthYearDisplay.innerText = `${monthNames[currentCalMonth]} ${currentCalYear}`;
        
        // Render empty offset cells
        for (let i = 0; i < firstDay; i++) {
            daysContainer.innerHTML += `<div class="calendar-day empty"></div>`;
        }
        
        // Render days
        for (let day = 1; day <= daysInMonth; day++) {
            const m = String(currentCalMonth + 1).padStart(2, '0');
            const d = String(day).padStart(2, '0');
            const currentCellDate = `${currentCalYear}-${m}-${d}`;
            
            let eventsHTML = '';
            
            academicEvents.forEach(evt => {
                if (currentCellDate >= evt.start && currentCellDate <= evt.end) {
                    let typeClass = '';
                    if (evt.type === 'holiday') typeClass = 'event-holiday';
                    if (evt.type === 'exam') typeClass = 'event-exam';
                    
                    eventsHTML += `<div class="event-badge ${typeClass}">${evt.title}</div>`;
                }
            });
            
            daysContainer.innerHTML += `
                <div class="calendar-day">
                    <span class="day-num">${day}</span>
                    ${eventsHTML}
                </div>
            `;
        }
    }

    function changeMonth(direction) {
        currentCalMonth += direction;
        if (currentCalMonth < 0) { currentCalMonth = 11; currentCalYear--; }
        if (currentCalMonth > 11) { currentCalMonth = 0; currentCalYear++; }
        renderFullCalendar();
    }

    // --- CALENDAR SEARCH LOGIC ---
    function searchCalendarEvents() {
        const input = document.getElementById('calendarSearch').value.toLowerCase();
        const suggestionBox = document.getElementById('calendarSuggestions');
        suggestionBox.innerHTML = '';
        if (input.length < 2) { suggestionBox.style.display = 'none'; return; }

        const matches = academicEvents.filter(evt => {
            const dateStr = new Date(evt.start).toLocaleDateString('en-US', { month: 'short', day: 'numeric'}).toLowerCase();
            return evt.title.toLowerCase().includes(input) || evt.start.includes(input) || dateStr.includes(input);
        });

        if (matches.length > 0) {
            suggestionBox.style.display = 'block';
            matches.forEach(match => {
                const div = document.createElement('div');
                div.className = 'suggestion-item';
                const dateStrDisplay = new Date(match.start).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                div.innerHTML = `<strong>${match.title}</strong><span class="shortcut-badge">${dateStrDisplay}</span>`;
                div.onclick = () => {
                    const matchDate = new Date(match.start);
                    currentCalYear = matchDate.getFullYear();
                    currentCalMonth = matchDate.getMonth();
                    renderFullCalendar();
                    document.getElementById('calendarSearch').value = '';
                    suggestionBox.style.display = 'none';
                };
                suggestionBox.appendChild(div);
            });
        } else {
            suggestionBox.style.display = 'none';
        }
    }

    // --- INIT ---
    window.onload = function() {
        initGrid();
        addCourseRow(); addCourseRow(); addCourseRow();
        renderFullCalendar();
        document.addEventListener('click', e => {
            // Close exam suggestions
            if (!e.target.closest('#courseSearch')) {
                const sugg = document.getElementById('suggestions');
                if (sugg) sugg.style.display = 'none';
            }
            // Close calendar suggestions
            if (!e.target.closest('#calendarSearch')) {
                const calSugg = document.getElementById('calendarSuggestions');
                if (calSugg) calSugg.style.display = 'none';
            }
        });
    };
</script>

</body>
</html>

